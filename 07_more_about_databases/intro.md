# More about Databases

## ORMs

### ORM

オブジェクト関係マッピング（Object-relational Mapping）とは、データベースとオブジェクト指向プログラミング言語間の非互換なデータを変換する「**プログラミング技法**」である。要は、DBを扱いやすくするもの。

- 「インピーダンス・ミスマッチ」を解消し、RDBのレコードを直感的に扱えるようにする。
- RDBにアクセスするプログラムを書くときの煩雑な処理を軽減させ、プログラマがSQLを意識することなくコードを書ける。最高では？

### 「インピーダンスミスマッチ」とは？

- オブジェクト指向は「現実世界の物事に即したデータモデル」である。

- 関係データベースは「検索やCRUDなどの処理に最適化されたデータモデル」である。

このような設計思想の違いを「**インピーダンス・ミスマッチ**」と呼ぶ。

つまり、オブジェクト指向とデータベースの考えの差分を吸収して、どっちでもいい感じに使えるようにする技法がORM。

### ORMの例

- Acrive Record（Ruby on Rails）
- Eloquent（Laravel）

などが代表的なORM。
例としてAcrive Recordを使った時に得られる仕組みとして、以下のものがある。

- モデルとそのデータを表す仕組み
- モデル間の関連性を表す仕組み
- 関連するモデルを通した階層の継承を表す仕組み
- DBに保存する前に検証する仕組み
- オブジェクト指向の手法でDB操作を実行する仕組み

逆に、ORMがなければこの仕組みが無くなると考えると結構怖い。

クラスとテーブルの対応には、名前に関する規約が利用される。

- テーブル名がBookの場合、クラス名もBook
- 規約通りにクラスを作成すれば、中身が空でも正しくマッピングされる。
- 規約を外れる命令が必要な場合は、クラスに記述を追加すれば良い。

テーブルを作った後のActive Recordの動きは以下。

- ActiveRecordライブラリがDBのスキーマを実行時に読み取る
- カラム名と同じ名前の属性を使えるように、カラムのデータ型に従って、属性が適切なRubyのクラスへの対応付けが行われる。

メリット

- SQLを書かなくても良い（分かりきっていることを何回も書かなくても良い）
- データとオブジェクト（クラス）のマッピングを行わなくても良い
- `book.title #Book TItle1`のように、オブジェクト指向の手法で直感的にDB操作を行えるようになる

<!-- 便利だな🎶と思って使っていたが、これが無かったら手動でマッピングしないとオブジェクト操作が出来なかったとは… -->

## Transactions

## ACID

## CAP Theorem

## Data replication

## Sharding Strategies

## N + 1 Probrem

## Database Nomalization

## Index and how they work

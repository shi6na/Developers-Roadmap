# Internet

## How does the internet work？ - インターネットの仕組み

### インターネットとは

> インターネット（英: the Internetあるいはinternet）とは、インターネット・プロトコル・スイートを使用し、複数のコンピュータネットワークを相互接続した、グローバルなネットワーク（地球規模の情報通信網）のことである。

通信の時のお約束（プロトコル/インターネット・プロトコル・スイート）を決めることで、世界中のコンピュータやネットワークと接続することを可能にした技術。  

### 1990年代前半、ほとんどの人はインターネットを知らなかった

世界的に見るとインターネットを利用したことがある人の割合はごくわずか。  
eメールの送受信をしたこともなければウェブブラウザの画面を見たこともない！  
AppleやMS社などがインターネットに対応したOSやメールソフト、ブラウザを最初からインストール済みの状態で提供するようになると、  
便利さに気付く人や趣味で触り始める人が増え、2000年代には企業がインターネットを使ってマーケティングをするまでになった。

### インターネットは、ネットワークを世界中に繋がるようにしたもの

そもそもネットワークというのが、複数のコンピュータをケーブルや無線などを使って繋いでやりとりできるようにした仕組みのこと。
それを「ルータ」や「インターネットサービスプロバイダ」などを利用して、世界規模で接続できるようにした、
もっとも大きいネットワークのことを、**インターネット**と呼ぶ。

### JPNIC

インターネットでは、個々の端末の場所を「IPアドレス」という数字で管理している。
各国ごとに設置された機関がIPアドレスを利用者に配布しているが、
日本では社団法人日本ネットワークインフォメーションセンター（JPNIC）という組織が管理している。

### IETF-Internet Engineering Task Force

インターネット技術特別調査委員会。インターネットで利用される技術の標準を作成する組織。
この組織が通信技術の仕様を公開することで、多種多様なネットワーク間の通信方式の差異を緩和し、相互接続が可能な状態を維持することができている。

---

## What is HTTP? - HTTPって何

Hyper Text Transfer Protocolの略。直訳すると、超文書（ハイパーテキスト）転送通信規約。ラノベの呪文っぽい

- www(World Wide Web)において、Webブラウザ（IEやChrome、safariなど）とWebサーバとの間での転送に用いられる。  
- HTMLファイルやXMLなどのハイパーテキストだけでなく、スタイルシート（CSS）、スクリプト（jsなど）、画像、音声、動画などのファイルを、データ形式などのメタ情報を含めてやりとりすることができる。

### Hyper Textって何

> 複数の文書（テキスト）を相互に関連付け、結びつける仕組みである。
> 「テキストを超える」という意味から、hyper（〜を超えた）text（文書）と名付けられた。
つまるところ、普通のテキストにはない機能を備えた超テキスト。１つのテキストだけで、他のいろいろな文書や画像や図表、音声、３次元グラフィックなどを関連つけることができる。

- ハイパーテキストの力で実現していること
  - 文章中のキーワードをクリックすると、他の文章や画像を表示する。
  - 目次のページの項目をクリックすると、目的のページに移動する。
  - 書名をクリックすると、その本の情報を表示する。
  などなど。
  
### どうやってやりとりしているのか

ざっくりいうと以下。

1. クライアント(ブラウザ)から「あれが見たい」「これを見せろ」といったHTTPリクエストを送る。
1. サーバはそれを受け取り、解釈し、応答（HTTPレスポンス）を返す。
1. クライアントは応答を受け取り、解釈し、ユーザに見せる。初期状態に戻る。

### ポイント

- クライアントが要求メッセージとして「何を」「どうして」欲しいのかをサーバに伝えることで通信が成立する。
- 「何を」がURLで、メソッドが「どうして」にあたる。
- 3.で初期状態に戻っているが、実はHTTP通信は複数の状態を保持できない。そこでCookieが登場、複数の状態を跨ぐ複雑な処理ができるようになった。

### リクエストの中身

HTTPのリクエストは、**リクエストライン**、**ヘッダ**、（空行【CR+LF】）、**ボディ**からなる。

#### リクエストライン

何（URL）をどうしたいか（メソッド）が書かれている。  以下例。

`POST /search.html HTTP/1.1`

- 意味：`/`ディレクトリの`search.html`(URL)に`HTTP/1.1`を使って`POST`形式で(メソッド)値を送る
- `POST`：値を見えないところに隠して送る方法。データをサーバへ送信すること。リクエストをポストに投函するイメージ。
- `GET`：値を見えるところ（URLの末尾）につけて送る方法。リソースを取り込むこと。自らの手でゲットしてくるイメージ。❌機密情報の通信でこれを使ってはならない。
- `PUT`、`HEAD`、`OPTIONS`、`DELETE`など他にもあるが割愛。

#### ヘッダ

要求についてのことや、クライアント（要求者）についてのあれこれが書かれている。以下例。

```zsh
Host: localhost:8080
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.54 Safari/536.5
Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
Accept-Language: ja,en-us;q=0.7,en;q=0.3
Accept-Encoding: gzip,deflate
Accept-Charset: Shift_JIS,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Content-Type: text/plain
Content-Length: 23
```

| 項目 | 意味 |
| --- | --- |
| `Host` | 必須項目！クライアントからサーバに対して、クライアントのサーバ名を送信する。`localhost`の`8080`ポートからアクセスしてるぞ、の意。 |
| `User-Agent` | ブラウザの種類やOSの情報。`Mozilla/5.0`の`Macintosh`の・・・（略）を使っているぞ、という意 |
| `Accept` | ブラウザが受信可能なデータ形式。`*/*`は全てのMIMEタイプで、`;q=`は「Q値の重み」と呼ばれる、相対的な品質値を使用して表現される優先順位の順序で配置された値。<br>例でいうと0.9、0.8、0.5になっているので、降順できちんと並んでいるのがわかる。 |
|`Accept-Language` | ブラウザが受信可能な言語をサーバに伝える。以下、`Accept-××`系は全部「受信可能な××の形式」的な意味。 |
| `keep-Alive` | 持続的接続をする際に、次の要求がこない場合にタイムアウトを発生させる時間を指定。 |
| `Connection` | 持続接続を継続するか否かを指定できるところ。今回は`keep-alive`なのでもう一回持続接続をする。最後の要求なら`close`を指定。 |
| `Content-Type` | コンテンツ（＝ボディ）の種類を表す。今回は`text/plain`なのでプレーンテキスト。 |
| `Content-Length` | コンテンツ（＝ボディ）の長さをバイト単位で表す。今回は`23`バイトある。|

- その他の項目の意味はこちら→[HTTP入門](http://www.tohoho-web.com/ex/http.htm)

#### ボディ

- といいつつ、HTTPリクエストのボディは補足のメモ書きスペースで、必要な情報が必要に応じて書いてある。中身がない時もある（GETメソッドの時とか）。
- もしメソッドがPOSTであれば、受け渡されるパラメータの内容が記述される。
- ボディとヘッダの間には、必ず一行空白行を入れなければならない。
- ボディが` key1=value1&key2=value2 `だと、key1（=value）とkey2（=value2）を送ることになる。

### レスポンスの中身

レスポンスもだいたい一緒で、**ステータスライン**、**ヘッダ**、（空行）、**ボディ**から構成される。

#### ステータスライン

プロトコルのバージョン、ステータスコード、説明テキストが書いてある。  
例えば` HTTP/1.1 200 OK `だと、`HTTP/1.1`で通信したよ、ステータスコードは`200`で、`OK`、通信は成功した。的な意味。
  
- **ステータスコード**

HTTPのレスポンス具合を表す３桁のコード。よく見かけるのは403(Forbidden/アクセス権なし)、404(NotFound/存在しない)、500(サーバ内部エラー)辺り。

- 100番台：情報（※HTTP1.0では未割り当て）
- 200番台：成功
- 300番台：転送
- 400番台：クライアントエラー（ブラウザで見ている側（クライアント側）に問題アリ）
- 500番台：サーバエラー（見せている側、コンテンツを作っている側（サーバ側）に問題あり）

#### ヘッダ

リクエストの時と同じでいろいろと書いてある。以下一例。

```zsh
Date: Sun, 25 Mar 2018 14:19:50 GMT
Content-Type: text/html; charset=utf-8
Transfer-Encoding: chunked
Connection: keep-alive
Server: nginx
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
X-Content-Type-Options: nosniff
ETag: W/"ZGFmaWhlcmlvaGZnaWVhZ2h1aWVybGFoZmdpbGVyaA"
Cache-Control: max-age=0, private, must-revalidate
Set-Cookie: _qiita_login_session=YWZlZ3Jld2d3aW9lZ3Zkbmp2Y252ZGthamZnaWVv; domain=.qiita.com; path=/; expires=Mon, 25 Mar 2019 14:19:50 -0000; HttpOnly
X-Runtime: 0.253271
Strict-Transport-Security: max-age=2592000
X-Request-Id: 1650d346-2ed3-4bcb-9789-ed404ae13d31
Content-Security-Policy-Report-Only: default-src https: data: 'unsafe-eval' 'unsafe-inline'; report-uri https://us-central1-qiita-csp-report.cloudfunctions.net/csp-report
```

- 意味（一部。リクエストと同じ意味のものは略。）
| 項目名 | 説明　|
| --- | --- |
| `Date` | 日付情報。レスポンスを返した段階の年月日、時間。 |
| `Transfer-Encoding` | 利用されている転送エンコーディング形式。HTTP1.1では[チャンク形式](http://e-words.jp/w/%E3%83%81%E3%83%A3%E3%83%B3%E3%82%AF.html)が定義されている、ということで`chunked`。 |
| `Server` | サーバからクライアントに対して、サーバ情報を返す。今回だとnginxというサーバを使ってますよの意。↔︎`Host` |
| `X-Frame-Options` | ちょっと特殊なフィールド。ブラウザがページを`<frame>`、`<iframe>`、`<emded>`、`<object>`の中に表示することを許可するかどうかを示す。ここで[クリックジャッキング攻撃](https://ja.wikipedia.org/wiki/%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E3%82%B8%E3%83%A3%E3%83%83%E3%82%AD%E3%83%B3%E3%82%B0)対策ができる。今回は`SAMEORIGIN`なので同じオリジンのページに含まれるページのフレーム内でのみ表示される。|
| `X-XSS-Protection` | さっきと似ているが、今度は[XSS（クロスサイトスクリプティング）](https://ja.wikipedia.org/wiki/%E3%82%AF%E3%83%AD%E3%82%B9%E3%82%B5%E3%82%A4%E3%83%88%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0)対策に使われるフィールド。これを有効にしておくと、XSSを検知した時に、ページの読み込みを停止してくれる。今回は`1; mode=block`なのでXSSフィルタリングは有効化され、ページのサニタイジングよりもレンダリング停止を優先する。標準だとブラウザ側でこの機能が有効になっているはずだが、何らかの理由で無効になっている時に、このヘッダフィールドが役に立つ。
| `X-Content-Type-Options: nosniff` | `Content-Type`フィールドで指定されたコンテンツタイプが変更されずに従われるべきであることを示す。コンテンツの盗聴をブロックすることができる。`nosniff`まででワンセット。ブラウザがIEの場合特に大事らしく、「IE、[Content sniffingはするなよ](https://www.atmarkit.co.jp/ait/articles/0903/30/news118.html)、」ということ。リクエストされたタイプが「`style`なのに、指定したタイプが`text/css`でない」もしくは「`script`なのに、`Javascript`MIMEタイプではない」場合、そのリクエストはブロックされる。 |
| `ETag` | エンティティとそのバージョンを一意に識別する識別子を示します。エンティティ(E)タグ(Tag)かな？ |
| `Cache-Control` | キャッシュに関する指示を表す。 |
| `Set-Cookie` | Cookieの設定。 |
| `X-Runtime` | サーバでの処理時間。レスポンスタイムともいう。この項目をヒントにサイドチャネル攻撃ができてしまうという話があるので、心配ならこの項目はつけない方が良いかもしれない。→[x-runtime は消すべきなのか - Qiita](https://qiita.com/yuku_t/items/09f017c47b780e49422b) |
| `Strict-Transport-Security` | サーバがブラウザ（クライアント）に、HTTPの代わりにHTTPSを用いて通信しなさいと指示するためのもの。これをつけるとHTTPのサイトを一切読み込まず、全てのアクセスを自動的にHTTPからHTTPSリクエストに変換するよう指示することができる。なんて便利なんだ。`max-age`は、ブラウザに「このサイトはHTTPSだけで接続するんだぞ」ということを覚えさせておく時間。今回の例で言えば2592000秒（=一ヶ月）覚えさせる。ここの解説がわかりやすいので読んでほしい→[Strict-Transport-Security - HTTP | MDN](https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Strict-Transport-Security) |
| `X-Request-Id`：サーバは個々のリクエストに固有のユニークな文字列でIDをつけてくれる。それ示すフィールド。ここをいじると`grep`とかしやすくなる。 |
| `Content-Security-Policy-Report-Only`：長！これをつけると、セキュリティポリシーに違反したらレポートを送ってくれる。ので、セキュリティポリシーの効果を監視することができる。 |
- その他の項目の意味はこちら→[HTTP入門](http://www.tohoho-web.com/ex/http.htm) 

#### ボディ

本体。レスポンスは絶対ボティの中身があるはず。中身は多種多様なハイパーテキスト達で、ブラウザからの通信ならHTMLが一番多そう。もちろん、JSON、XML、CSSなどなどリクエストに応じて様々。

### どこからHTTP通信の内容が見られるのか

- コンソールから見たい方：[HTTPリクエスト/レスポンスの構成要素を初心者にも分かるように解説してみた - Qiita](https://qiita.com/koheiyamaguchi0203/items/5777c4653a01ae4c7b06)
- ブラウザから見たい方：[HTTPレスポンスヘッダ・リクエストヘッダ情報をウェブブラウザで表示・確認する方法](https://memorva.jp/memo/dev/webbrowser_http_response_request_header.php)

### 認証

- 限られた人にしか情報を見て欲しくないときがある。会員サイトとか、クレジットカードの情報とか。でも、この世には「なりすます」人がいる。そんなときには「認証」機能を使う。HTTPはちゃんと認証手順についても定めている。
- 当初規定したのは、「ID」と「パスワード」でやりとりする「**基本認証（Basic認証）**」と呼ばれる手順だったが、パスワードが通信中に盗聴される危険性があった。
- そこで、チャレンジ/レスポンス方式の「**ダイジェスト認証（Digest認証）**」が追加された。
- チャレンジ/レスポンス方式とは、簡単に言うと「山？（チャレンジ）」「川！（レスポンス）」のような方式。
- 暗号学的ハッシュ関数の性質（一方向性：ハッシュを作ることはできるけど、ハッシュから割り出すことはできない）を利用して、パスワードを直接やりとりすることなく確認する方式。

> クライアントが認証の開始を申し出ると、サーバは「**チャレンジ**」と呼ばれる、乱数を元に決めた毎回異なるデータ列を送信する。
> クライアントは利用者が自分の知っているパスワードとして入力した文字列と「チャレンジ」を組み合わせ、これをハッシュ関数に通してハッシュ値に変換したものを「**レスポンス**」としてサーバに返信する。
> サーバは手元の認証情報から正しいパスワードとチャレンジを組み合わせてハッシュ値を算出し、「レスポンス」と比較、照合。合致すれば、パスワードも正しいことがわかるので、認証成功。

## Browsers and how they work?-ブラウザとその仕組み

### ブラウザとは

> インターネット上のウェブ ページの情報を画面上に表示するための閲覧ソフト。また一般に、コンピュータのデータやプログラムを、画面上に文字や画像として表示するためのプログラムも言う。

### ブラウザの仕事

クライアント（Webブラウザを使っている人）が要求した場所のWebサーバに行き、情報をくれというリクエストを送る。
するとWebサーバが画像やテキストといったデータをWebブラウザに送り、Webブラウザが情報を解釈して表示する。

### HTMLパーサー

> HTMLファイルを読み込んだWebブラウザは、きちんとHTMLの文法に沿って書かれているかチェックをしながら本文・見出し、脚注や画像といった要素を解析している。
> このHTMLを解析するパートを「**HTMLパーサー**」と呼ぶ。

パーサーは、HTMLだけではなくXMLやJavascriptに対しても利用する。  
パーシングしたデータを整理して、要素ごとに分類され、Webブラウザ内に取り込まれる。  
最後に、取り込んだデータの通りに画面を表示する。表示することを**レンダリング**と言う。

#### どんなファイルが読み取れるのか

Webブラウザが読み取れるのは「テキストファイル」「画像ファイル」だけで、  
Flashや各種動画などの**リッチコンテンツ**と呼ばれるものはWebブラウザ単体では表示できない。  
そこで**プラグイン**と呼ばれる外部からの拡張機能のプログラムを導入し、それらのデータを表示する。  
もちろん表示するだけではなく、JavascriptやPHPなどのプログラミング言語を読み込んで、リアルタイム表示をすることもできる。

## DNS and how it works?- DNSとその仕組み

DNS：Domain Name System

- IPアドレスを人間が覚えやすいドメインに変換するためのもの
- 203.142.205.153というIPアドレスと、www.fenrir.co.jp というドメイン名があったら、人間は後者の方が覚えやすい
- そこで、IPアドレスの数字とドメイン名を結びつけて、変換する情報を保管するのがDNS

### どうやって変換してるの？（ドメイン名がfenrir.co.jpの場合）

1. Webブラウザ打ち込まれたURLからドメイン名（fenrir.co.jp）を取得
1. ルートDNSサーバ（DNSサーバの元締め、親分みたいなやつ）に、「このドメインのIPアドレスは？」と聞きに行く
1. ルートDNSサーバは、「.jp担当のDNSサーバに聞いて」と言う
1. .jpのDNSサーバに「このドメインのIPアドレスは？」と聞きに行く
1. 「fenrir.co.jp担当のDNSサーバに聞いて」と言う
1. fenrir.co.jp担当のDNSサーバに「このドメインのIPアドレスは？」と聞きに行く
1. 「203.142.205.153」ですと返してくれる
1. アクセスできる👏

### DNSキャッシュサーバ

フルサービスリゾルバのこと。  
ドメイン名をIPアドレスに変換する時、一番最初にDNSルートサーバに問い合わせをするが、  
DNSルートサーバは世界で13台しかないので、アクセスを集中させないために、
DNSキャッシュサーバが自分の持っているキャッシュ（カンペ。過去に紐付けした組み合わせ）を見て紐付けを探す。

## What is Domain Name-ドメイン名って何

- インターネット上の住所。例えば「<https://www.fenrir-inc.com/jp/」> だったら、「fenrir-inc.com」 がドメイン名。
- `fenrir-inc`がサブドメインで、`.com`がトップレベルドメイン。
- サブドメインは自由に決められるドメイン、トップレベルドメインは使用している人によって種類が変わるドメイン。

### 分野別トップレベルドメイン(gTLD)

利用者の居住国に関係なく誰でも取得できるドメインです。

| ドメインの種類 | 特徴 |
----|----
| com | 企業や商用サービスを表すドメイン |
| net | 主にネットワークサービスの提供者を表すドメイン |
| org | 主に非営利団体を表すドメイン |
| biz | 主にビジネスを表すドメイン |
| info | 主に情報の提供者を表すドメイン |

### 国コードトップレベルドメイン(ccTLD)

国ごと・地域ごとに割り当てられたドメインで、基本的にはその国や地域に在住する個人でないと取得できない。日本であればjp。  

### 属性型JPドメイン名

jpの中でも、`.jp`の前に指定の文字列が入り、その文字列ごとに取得可能な組織が限定されるドメインのこと。

| ドメインの種類 | 特徴 |
----|----
| co.jp | 日本国内で登記を行っている会社・企業が登録可能  （株式会社・有限会社など）|
| or.jp | 特定の法人組織が登録可能（例：財団法人、社団法人、医療法人、農業協同組合、生活協同組合など） |
| ne.jp | 主に非営利団体を表すドメインネットワークサービスごとに登録可能 |
| ac.jp | 学校教育法などの規定による学校が登録可能（大学、大学院、高等専門学校、学校法人、職業訓練校） |
| go.jp | 日本国の政府機関、各省庁が管轄する研究所、特殊法人（特殊会社を除く）が登録可能 |

`co`などの文字が入らず、個人でも取得できる`.jp`ドメインのことを汎用JPドメイン名という。

## What is hosting? - ホスティングって何

> ホスティングサービスとは、通信事業者などが提供するサービスの一つで、
> 専用の施設内に設置されたサーバコンピュータをインターネットを通じて顧客に貸与するもの。
> 顧客は借り受けたコンピュータに必要なソフトウェアやデータを導入して運用する。
> [ホスティングサービス（レンタルサーバ）とは - IT用語辞典 e-Words](http://e-words.jp/w/%E3%83%9B%E3%82%B9%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9.html)

一言でいうと「**サーバを借りること**」。サーバを借りて、そこにWebサービスなりなんなりを置かせていただく。
自社サーバだと会社内でしか使えないことが多いが、
ホスティングを利用すれば、遠隔地での利用が可能になる。
サーバを置いておく場所のことを「データセンター」と呼ぶ。
最近だと**AWS**、**さくらインターネット**が有名。

### バーチャルウェブとインテグラル

それぞれ「共有ホスティング」と「専用ホスティング」と呼ばれることもある。
共有ホスティングは、複数のユーザが1つのサーバを共同で利用すること。
専用ホスティングとは、1ユーザで1つのサーバを専有していることを指す状態。

### ハウジング（コロケーション）サービスとの違い

これもサーバを利用するのは同じだが、こちらは自分でサーバを用意して、サービス事業者に預けるサービス。
置く場所、ネットワーク回線、その他付随するサービス（機器LEDの目視監視など）を提供してくれる。
サーバ環境だけ作って預けてしまえば、自分でサーバルームを作る必要もないし、ずっと監視している必要もなし。

### クラウドサービスとの違い

SaaSとPaaSとIaaSの3種類を包括して「クラウドサービス」と呼ぶ。  

- SaaSは「Softwere as a Service」のことで、Gmailなどのようにインターネットに接続するだけで利用できるサービスのことを言う。
- Paasとは、「Platform as a Service」のことで、システム開発などの際に必要になる基盤を提供するサービスのことを言う。Cloud9？
- IaaSとは、「Infrastructure as a Service」のことで、システム基盤を作成するためのインフラを提供するサービスのこと。

ホスティングは、一台の物理サーバーの機能を全て共有して利用するのに対し、  
クラウドは、一台の物理サーバの中に仮想サーバを複数建て、それらを個別に利用する。こちらは構築や運用、セキュリティ対策をカスタマイズできる。  

#### 余談

AWSをデータセンター含めて作るにはいくらかかるみたいな記事が面白かった
👉[awsって最近すごいらしいね？あれいくらで作れる？を雑に見積もる - Qiita](https://qiita.com/otupy/items/0448468cbc833d407302)
